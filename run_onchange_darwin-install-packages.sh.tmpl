{{ if eq.chezmoi.os "darwin" -}}
#!/bin/bash

# Brewfileã®ãƒãƒƒã‚·ãƒ¥å€¤ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦åŸ‹ã‚è¾¼ã‚€
# ã“ã‚Œã«ã‚ˆã‚Šã€Brewfileã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå±•é–‹çµæœãŒå¤‰ã‚ã‚‹ã¨ã€ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ãƒãƒƒã‚·ãƒ¥ã‚‚å¤‰ã‚ã‚Šã€å®Ÿè¡Œã•ã‚Œã‚‹
# Brewfile hash: {{ include "dot_config/homebrew/Brewfile.tmpl" | sha256sum }}

set -eufo pipefail

echo "ğŸº Homebrew Bundle Update Detected..."

# Homebrewè‡ªä½“ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒã‚§ãƒƒã‚¯
if! command -v brew &> /dev/null; then
    echo "   Homebrew not found. Installing..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    # Apple Siliconãƒ‘ã‚¹è¨­å®š
    if [[ "$(uname -m)" == "arm64" ]]; then
        echo 'eval "$(/opt/homebrew/bin/brew shellenv)"' >> $HOME/.zprofile
        eval "$(/opt/homebrew/bin/brew shellenv)"
    fi
fi

# Brewfileã®å ´æ‰€ã‚’æŒ‡å®šã—ã¦bundleå®Ÿè¡Œ
# --cleanup: Brewfileã«è¨˜è¿°ã®ãªã„ã‚¢ãƒ—ãƒªã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆå®Œå…¨åŒæœŸï¼‰
# --no-lock: Lockãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ãªã„
brew bundle install --file="$HOME/.config/homebrew/Brewfile" --cleanup --no-lock

echo "âœ… Homebrew packages are in sync."
{{ end -}}
